<div *ngIf="paketparameterForm" class="page-layout carded fullwidth inner-scroll" style="width: 100%;
padding-bottom: 70px; overflow: auto;"[style.height.px]="this.screenHeight">
    <form name="paketparameterForm" [formGroup]="paketparameterForm" class="product w-100-p" fxLayout="column" fxFlex>
        <div id="paketparameterdet" class="page-layout carded fullwidth inner-scroll">
            <div class="top-bg primary"></div>
            <!-- / TOP BACKGROUND -->

            <!-- CENTER -->
            <div class="center" style="overflow: auto; scrollbar-width: thin;">

                <!-- HEADER -->
                <div class="header primary" fxLayout="row" fxLayoutAlign="space-between center">

                    <div fxLayout="row" fxLayoutAlign="start center">

                        <button mat-icon-button class="mr-0 mr-sm-16" [routerLink]="'/analystpro/paket-parameter'">
                            <mat-icon>arrow_back</mat-icon>
                        </button>

                        <div *ngIf="this.idpaketparameter === 'add'">
                            <div fxLayout="column" fxLayoutAlign="start start"
                                [@animate]="{value:'*',params:{delay:'100ms',x:'-25px'}}">
                                <div class="text-customer h2">
                                    Add Data
                                </div>

                                <div class="subtitle secondary-text">
                                    <span>Paket Parameter</span>
                                </div>
                            </div>
                        </div>

                        <div *ngIf="this.idpaketparameter !== 'add'">
                            <div fxLayout="column" fxLayoutAlign="start start"
                                [@animate]="{value:'*',params:{delay:'100ms',x:'-25px'}}">
                                <div class="text-customer h2">
                                    Edit Data
                                </div>

                                <div class="subtitle secondary-text">
                                    <span>Paket Parameter</span>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
                <div class="content-card" style="overflow: auto; height: 60vh;">
                    <mat-progress-bar color="primary" mode="indeterminate" value="50" *ngIf="load">
                    </mat-progress-bar>
                    <div class="content" style="overflow-y: auto; scrollbar-width: thin;" *ngIf="paketparameterForm">
                        <div class="tab-content p-24" fusePerfectScrollbar *ngIf="paketujiData">
                            <mat-grid-list cols='3' rowHeight="100px" gutterSize="20px">
                                <mat-grid-tile colspan="2"> 
                                    <mat-form-field appearance="outline">
                                        <mat-label>Nama Paket</mat-label>
                                        <input matInput formControlName="nama_paket" placeholder="Package Name">
                                    </mat-form-field>
                                    <div style="width: 10px"></div>
                                    <mat-form-field appearance="outline">
                                        <mat-label>Nama Paket En</mat-label>
                                        <input matInput formControlName="nama_paket_en" placeholder="Package Name English">
                                    </mat-form-field>
                                </mat-grid-tile>  
                                
                                <mat-grid-tile>
                                    <mat-form-field appearance="outline">
                                        <mat-label>Price</mat-label>
                                        <input matInput placeholder="Price" currencyMask [options]="{ prefix: '', thousands: '.', precision: 0 }" name="price" formControlName="price"
                                             required>
                                            <mat-error>
                                                Price Must be filled
                                            </mat-error>
                                    </mat-form-field>
                                </mat-grid-tile>

                                <mat-grid-tile colspan="2">
                                    <mat-form-field appearance="outline" floatLabel="always">
                                        <mat-label>Description</mat-label>
                                        <textarea matInput placeholder="Description" name="description"
                                            formControlName="description" rows="1">
                                            </textarea>
                                    </mat-form-field>
                                </mat-grid-tile>

                                <mat-grid-tile>
                                    <mat-form-field appearance="outline">
                                        <mat-label>Discount</mat-label>
                                            <mat-select formControlName="discount">
                                              <mat-option value="1">
                                                Yes
                                              </mat-option>
                                              <mat-option value="0">
                                                No
                                              </mat-option>
                                            </mat-select>
                                    </mat-form-field>
                                </mat-grid-tile>

                                <div>
                                    <mat-grid-tile>
                                        <mat-form-field appearance="fill">
                                            <mat-label>Reference</mat-label>
                                            <mat-select formControlName="reference" (change)="selectingReference($event)">
                                              <mat-option value="paket">Paket Uji</mat-option>
                                              <mat-option value="nonpaket">Parameter Uji</mat-option>
                                            </mat-select>
                                          </mat-form-field>
                                    </mat-grid-tile>
                                    <mat-grid-tile *ngIf="this.paketparameterForm.controls.reference.value === 'nonpaket'">
                                        <ng-select appearance="fill" appendTo="body" [items]="parameterUjiData"
                                            bindLabel="name_id" bindValue="id" (clear)="resetPaketparameter()" formControlName="parameterpick"
                                            placeholder="Select Parameter Uji" (scrollToEnd)="onScrollToEndParameter('parameteruji')"
                                            (change)="getValDataPaketparameter($event)" dropdownPosition="bottom" (search)="sad($event)"
                                            style="width: 100%;">
                                            <ng-template ng-option-tmp let-item="item" let-index="index">
                                                <div title="{{item.name_id}}"><span>{{item.parameter_code}} - {{item.name_id}}</span></div>
                                            </ng-template>
                                            <ng-template ng-label-tmp let-item="item">
                                                <div title="{{item.name_id}}"><span>{{item.parameter_code}} - {{item.name_id}}</span></div>
                                            </ng-template>
                                        </ng-select>
                                    </mat-grid-tile>
                                    <mat-grid-tile *ngIf="this.paketparameterForm.controls.reference.value !== 'nonpaket'">
                                        <ng-select appearance="fill" appendTo="body" [items]="dataPaketuji" bindLabel="nama_paketuji"
                                    bindValue="id" placeholder="Select Package" dropdownPosition="bottom" formControlName="paketujipick"
                                    (scrollToEnd)="onScrollToEndParameter('paketparameter')" (change)="getValPaketuji($event)"
                                    (search)="onSearchPaketParameter($event)" (clear)="clearSelect('paketparameter')"
                                    style="width: 100%; align-self: center;">
                                    <ng-template ng-option-tmp let-item="item" let-index="index" style="z-index: 1000 !important;">
                                        <div title="{{item.nama_paketuji}}"><b>{{item.nama_paketuji}}</b>&nbsp;-&nbsp;{{item.price.toLocaleString()}}</div>
                                    </ng-template>
                                    <ng-template ng-label-tmp let-item="item">
                                        <div title="{{item.nama_paketuji}}"><b>{{item.nama_paketuji}}</b>&nbsp;-&nbsp;{{item.price.toLocaleString()}}</div>
                                    </ng-template>
                                </ng-select>
                                    </mat-grid-tile>
                                    <mat-grid-tile>
                                        <button mat-raised-button color="primary" (click)="tambah()" style="width: 90%;">Add</button>
                                    </mat-grid-tile>
                                </div>
                            </mat-grid-list> 
                        </div>

                            
                    </div>
                    
                </div>
                <div style="padding: 10px; width: 72vw; overflow: auto;">
                    <mat-table style="width: 1300px;" #table [dataSource]="paketparameterchoose" formArrayName="parameter" class="paketparameter">
                        <!-- Position Column -->
                        <ng-container matColumnDef="no">
                            <mat-header-cell *matHeaderCellDef style="background-color: white;">
                                <mat-checkbox class="checkbox-control" color="primary" (change)="checkAll($event.checked, 'all')"></mat-checkbox></mat-header-cell>
                            <mat-cell *matCellDef="let row; let e=index" [formGroupName]="e" style="height: 80px;">
                                <mat-checkbox formControlName="checked" (change)="checkAll($event.checked, row, e)"></mat-checkbox>
                            </mat-cell>
                          </ng-container>

                          <ng-container matColumnDef="action">
                            <mat-header-cell *matHeaderCellDef>Action</mat-header-cell>
                            <mat-cell *matCellDef="let a; let i = index;" [formGroupName]="i" style="height: 80px;">
                                <button mat-icon-button [matMenuTriggerFor]="menu">
                                    <mat-icon>more_vert</mat-icon>
                                  </button>
                                  <mat-menu #menu="matMenu">
                                    <button mat-menu-item (click)="copydata(a,i)">
                                      <span>Copy</span>
                                    </button>
                                    <button mat-menu-item (click)="pastedata(a,i)">
                                      <span>Paste</span>
                                    </button>
                                    <button mat-menu-item (click)="deletedata(a,i)">
                                      <span>Delete</span>
                                    </button>
                                  </mat-menu>
                            </mat-cell>
                          </ng-container>
    
                        <!-- Name Column -->
                        <ng-container matColumnDef="name_id">
                            <mat-header-cell *matHeaderCellDef>Parameter Name
                            </mat-header-cell>
                            <mat-cell *matCellDef="let a; let e = index"> 
                                <div style="display: flex; flex-direction: column; align-items: flex-start; justify-content: center;">
                                    <span>{{a.name_id}}</span>
                                    <span>{{a.parameter_code}}</span>
                                </div>
                            </mat-cell>
                        </ng-container> 
    
                        <!-- Name Column -->
                        <ng-container matColumnDef="lab">
                            <mat-header-cell *matHeaderCellDef>Lab
                            </mat-header-cell>
                            <mat-cell *matCellDef="let a; let e=index" [formGroupName]="e">
                                <ng-select 
                                appearance="fill" 
                                appendTo="body" 
                                [items]="datalab" 
                                bindLabel="nama_lab"
                                bindValue="id" 
                                placeholder="Select Lab" 
                                dropdownPosition="bottom"
                                (scrollToEnd)="onScrollToEndParameter('lab')" 
                                (change)="getVal($event,'lab')"
                                (search)="onSearch($event,'lab')" 
                                (clear)="clearSelect('lab')"
                                formControlName="id_lab"
                                style="width: 90%; align-self: center;">
                            </ng-select>
                            </mat-cell>
                        </ng-container>
    
    
                        <ng-container matColumnDef="lod">
                            <mat-header-cell *matHeaderCellDef>LOD
                            </mat-header-cell>
                            <mat-cell *matCellDef="let a; let e=index" [formGroupName]="e">
                                <ng-select 
                                appearance="fill" 
                                appendTo="body" 
                                [items]="datalod" 
                                (click)="clickSelect($event,'lod')"
                                bindLabel="nama_lod"
                                bindValue="id" 
                                placeholder="Select LOD" 
                                dropdownPosition="bottom"
                                (scrollToEnd)="onScrollToEndParameter('lod')" 
                                (change)="getVal($event,'lod')"
                                (search)="onSearch($event,'lod')" 
                                (clear)="clearSelect('lod')"
                                formControlName="id_lod"
                                style="width: 90%; align-self: center;">
                            </ng-select>
                            </mat-cell>
                        </ng-container>
    
    
                        <ng-container matColumnDef="unit">
                            <mat-header-cell *matHeaderCellDef>Satuan
                            </mat-header-cell>
                            <mat-cell *matCellDef="let a; let e=index" [formGroupName]="e">
                                <ng-select 
                                appearance="fill" 
                                appendTo="body" 
                                [items]="dataunit" 
                                (click)="clickSelect($event,'satuan')"
                                bindLabel="nama_unit"
                                bindValue="id" 
                                placeholder="Select Satuan" 
                                dropdownPosition="bottom"
                                (scrollToEnd)="onScrollToEndParameter('unit')" 
                                (change)="getVal($event,'unit')"
                                (search)="onSearch($event,'unit')" 
                                (clear)="clearSelect('unit')"
                                formControlName="id_unit"
                                style="width: 90%; align-self: center;">
                            </ng-select>
                            </mat-cell>
                        </ng-container>
    
                        <ng-container matColumnDef="metode">
                            <mat-header-cell *matHeaderCellDef>Metode
                            </mat-header-cell>
                            <mat-cell *matCellDef="let a; let e=index" [formGroupName]="e">
                                <ng-select 
                                appearance="fill" 
                                appendTo="body" 
                                [items]="dataMetode" 
                                bindLabel="metode"
                                (click)="clickSelect($event,'metode')"
                                bindValue="id" 
                                placeholder="Select Metode" 
                                dropdownPosition="bottom"
                                (scrollToEnd)="onScrollToEndParameter('metode')" 
                                (change)="getVal($event,'metode')"
                                (search)="onSearch($event,'metode')" 
                                (clear)="clearSelect('metode')"
                                formControlName="id_metode"
                                style="width: 90%; align-self: center;">
                            </ng-select>
                            </mat-cell>
                        </ng-container>
    
                        <ng-container matColumnDef="standart">
                            <mat-header-cell *matHeaderCellDef>Standart
                            </mat-header-cell>
                            <mat-cell *matCellDef="let a; let e=index" [formGroupName]="e">
                                <ng-select 
                                appearance="fill" 
                                appendTo="body" 
                                [items]="datastandart" 
                                bindLabel="nama_standart"
                                loadingText='Loading...'
                                (click)="clickSelect($event,'standart')"
                                bindValue="id" 
                                placeholder="Select Standart" 
                                dropdownPosition="bottom"
                                (scrollToEnd)="onScrollToEndParameter('standart')" 
                                (change)="getVal($event,'standart')"
                                (search)="onSearch($event,'standart')" 
                                (clear)="clearSelect('standart')"
                                formControlName="id_standart"
                                style="width: 90%; align-self: center;">
                            </ng-select>
                            </mat-cell>
                        </ng-container>
    
                        <mat-header-row *matHeaderRowDef="displayedColumns; sticky:true">
                        </mat-header-row>
                        <mat-row *matRowDef="let a; let i = index; columns: displayedColumns;">
                        </mat-row>
                    </mat-table>
                </div>
                <div class="button-action">
                    <button mat-raised-button color="primary" (click)="pastedata('all','all')" [disabled]="disablepasteall">Paste All</button>
                    <button mat-raised-button color="primary" (click)="delete('all','all')" [disabled]="jumlahapprove > 1 ? 'false' : 'true'">Delete All</button>
                    <!-- <button mat-raised-button color="primary" (click)="delete()">Delete</button> -->
                    <button mat-raised-button color="warn" (click)="saveNewForm()" *ngIf="this.idpaketparameter === 'add'">Save</button>
                    <button mat-raised-button color="warn" (click)="saveNewForm()" *ngIf="this.idpaketparameter !== 'add'">Edit</button>
                    <!-- <button mat-raised-button color="primary">Approve</button> -->
                </div>
            </div>
        </div>
    </form>
</div>