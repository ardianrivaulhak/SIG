<div id="preparation" class="page-layout simple" >
    <div class="content" style="overflow: auto;">
        <mat-card fxLayoutAlign="space-between center" *ngIf="contractData.length > 0">
            <div *ngIf="this.contractData.length > 0" style="padding: 10px; margin-top: 20px; margin-left: 10px;" >
                <span style="font-weight:800; font-size: 14px;"> {{ contractData[0].contract_no }}</span><br>
                <small style="font-style: italic; font-size: 10px;">{{ contractData[0].contract_category.title  }}</small><br>
                <span style="font-size: 12px;">{{ contractData[0].customers_handle.customers.customer_name }}</span>
            </div>
            <div *ngIf="this.contractData.length > 0" style="margin-right: 20px;">
                
    
                <button mat-icon-button color="white"
                    class="contract-certficate"
                    matTooltip="Contract"
                    aria-label="Example icon button with a filter list icon"
                    [@animate]="{value:'*',params:{delay:'150ms',scale:'0.2'}}"
                    (click)="preview()"
                    style="margin-left: -2px;">
                    <mat-icon>folder_shared</mat-icon>
                </button>

                <button mat-icon-button color="white"
                class="contract-certficate"
                matTooltip="Attachment Document"
                aria-label="Example icon button with a filter list icon"
                [@animate]="{value:'*',params:{delay:'150ms',scale:'0.2'}}"
                (click)="openAttachMent(contractData[0].id_kontrakuji, 'kontrak')"
                style="margin-left: -2px;">
                <mat-icon>attach_file</mat-icon>
            </button>
            </div>
        </mat-card>
        <mat-card style="margin: 0px;" [@animate]="{value:'*',params:{delay:'100ms',x:'-25px'}}" >  
            <div fxLayout="row" fxLayoutAlign="space-between center" [@animate]="{value:'*',params:{delay:'50ms',scale:'0.2'}}">          
                <form name="resultForm" class="product w-100-p" fxLayout="column" fxFlex>
                    <div fxLayout="column" fxLayoutAlign="space-evenly none">
                        <div fxLayout="row" fxLayoutAlign="space-between center" >                     
                            <mat-form-field appearance="outline" style="font-size: 11px" fxFlex="15" fxHide fxShow.gt-xs>
                                <mat-label>Status</mat-label>
                                  <mat-select                  
                                    class="select-me"
                                    [(ngModel)]="dataFilter.status"
                                    name="hold"
                                    style="display: flex;
                                    justify-content: center;
                                    align-items: center; 
                                    color:white !important;">
                                    <mat-option *ngFor="let status of status" [value]="status.id">
                                        {{ status.title }}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                            <mat-form-field appearance="outline" style="font-size: 11px" fxFlex="30" fxHide fxShow.gt-xs>
                                <mat-label>Sample Name</mat-label>
                                <input matInput 
                                name="sample"
                                [(ngModel)]="dataFilter.sample_name"
                                #filter >
                            </mat-form-field>                        
                            <mat-form-field appearance="outline" style="font-size: 11px;" fxFlex fxFlex="30">
                                <mat-label>Sample Number</mat-label>
                                <input matInput 
                                name="no_sample"
                                [(ngModel)]="dataFilter.sample_number"
                                #filter >
                            </mat-form-field>
                            <button mat-flat-button color="accent"  fxFlex="10"  fxFlex.xs="13" style="height: 40px; width:250px; margin-top: -13px;" (click)="searchButton()" >
                                Search
                            </button>
                            <button mat-flat-button color="warn" fxFlex="10"  fxFlex.xs="13" style="height: 40px; width: 100%; margin-top: -13px;" (click)="cancelSearchMark()" >
                                Reset
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between center">
                <mat-accordion style="width:100%;"  [@animate]="{value:'*',params:{delay:'100ms',scale:'0.2'}}">
                    <mat-expansion-panel [expanded]="true">
                      <mat-expansion-panel-header>
                        <mat-panel-title style="font-weight: 800;">
                          Memo
                        </mat-panel-title>
                      </mat-expansion-panel-header>
                      <div fxLayout="row" fxLayoutAlign="space-evenly center"  *ngIf="this.contractData.length > 0"  >
                        <mat-card style="width: 80%; margin-right: 10px; background-color: #E9EFC0;">
                            <h5 style="font-weight: 800;color: #4E944F;">Memo Control Lab</h5>
                            <ul *ngFor="let item of this.contractData[0].description_kendali" style="color: #463735;">
                                <li style="color: #4E944F;">{{ item.desc }}</li>
                            </ul>
                        </mat-card>
                        <mat-card style="width: 95%; background-color: #E9EFC0;">
                            <h5 style="font-weight: 800; color: #4E944F;">Memo Internal</h5>
                            <ul *ngFor="let item of this.contractData[0].description_cs" style="color: #4E944F;">
                                <li style="color: #4E944F;">{{ item.desc }}</li>
                            </ul>
                        </mat-card>
                      </div>                       
                    </mat-expansion-panel>
                  </mat-accordion>
            </div>
        </mat-card>
        <mat-card >
            <div fxLayout="row" fxLayoutAlign="space-between center" [@animate]="{value:'*',params:{delay:'50ms',scale:'0.2'}}" *ngIf="this.contractData.length > 0">
                <div>
                    <span style="font-weight: bold; color: #303030;" fxHide fxShow.gt-md>Preparation Detail &nbsp; | </span>
                    <button mat-icon-button color="white"
                        class="contract-certficate"
                        matTooltip="Bulk Memo Preparation"
                        (click)="descriptionInfoModals(this.checkList, 'withoutID')"
                        *ngIf="this.checkList.length > 0"
                        [@animate]="{value:'*',params:{delay:'150ms',scale:'0.2'}}" >
                        <mat-icon>info</mat-icon>
                    </button>
                    <button mat-icon-button color="white"
                        class="contract-certficate"
                        matTooltip="Paste"
                        (click)="pasteallbobotSambple()"
                        *ngIf="this.copyBobotSample.length > 0"
                        [@animate]="{value:'*',params:{delay:'150ms',scale:'0.2'}}" >
                        <mat-icon>replay</mat-icon>
                    </button>
                    <button mat-icon-button fxHide fxShow.gt-md matTooltip="Refresh"  (click)="refreshPage()">
                        <mat-icon style="color: #303030; ">refresh</mat-icon>
                    </button>
                    <button mat-icon-button color="white"
                    class="contract-certficate"
                    matTooltip="Cancel"
                    (click)="cancelCheckbox()"
                    *ngIf="this.checkList.length > 0"
                    [@animate]="{value:'*',params:{delay:'150ms',scale:'0.2'}}" >
                    <mat-icon>cancel</mat-icon>
                    </button>
                    <button mat-icon-button color="white" *ngIf="this.checkList.length > 0"
                        class="contract-certficate"
                        matTooltip="approve"
                        (click)="approveData()"
                        [@animate]="{value:'*',params:{delay:'150ms',scale:'0.2'}}"
                        style="margin-left: -2px;">
                            <mat-icon>check_circle</mat-icon>
                    </button>
                </div>

                <div [@animate]="{value:'*',params:{delay:'100ms',x:'-25px'}}">
                    <mat-paginator
                    [length]="this.total"
                    [pageSize]="this.to"
                    [pageIndex]="this.current_page"
                    hidePageSize="true"
                    (page)="pageEvent = $event; paginated($event)"
                >
                </mat-paginator>
                </div>
            </div>
        </mat-card>

        <mat-card style="margin-top: -25px;" *ngIf="this.sampledata.length > 0" >
            <mat-table class="lab-table" #table [dataSource]="sampledata" matSort (matSortChange)="sortData($event)"
        [@animateStagger]="{value:'50'}" fusePerfectScrollbar *ngIf="this.sampledata.length > 0">

        <ng-container matColumnDef="checkbox">
            <mat-header-cell *matHeaderCellDef mat-sort-header="checkbox"><mat-checkbox class="example-margin" 
                (change)="setAll($event.checked)"
                (change)="someComplete()"
                ></mat-checkbox>
            </mat-header-cell>
            <mat-cell *matCellDef="let sampleData">
                <mat-checkbox class="example-margin"
                [(ngModel)]="sampleData.completed"
                (ngModelChange)="updateAllComplete()"
                (change)="checkBox($event.checked, sampleData.id)"
                ></mat-checkbox>
            </mat-cell>
        </ng-container>

            <!-- Column -->
            <ng-container matColumnDef="sample_name">
                <mat-header-cell *matHeaderCellDef mat-sort-header="sample_name">Sample Name</mat-header-cell>
                <mat-cell *matCellDef="let sampleData">
                    <p style="white-space: normal;" matTooltip="{{sampleData.sample_name}}" class="text-truncate">{{sampleData.sample_name}}</p>
                </mat-cell>
            </ng-container> 

            <!-- Column -->
            <ng-container matColumnDef="no_sample">
                <mat-header-cell *matHeaderCellDef mat-sort-header="no_sample">Sample Number</mat-header-cell>
                <mat-cell *matCellDef="let sampleData"> 
                    <p  matTooltip="{{sampleData.no_sample}}" class="text-truncate">{{sampleData.no_sample}}</p>
                </mat-cell>
            </ng-container>

            <!-- Column -->
            <ng-container matColumnDef="stat_pengujian">
                <mat-header-cell *matHeaderCellDef  mat-sort-header="stat_pengujian">Status Testing</mat-header-cell>
                <mat-cell *matCellDef="let sampleData">
                    <div
                        class="box-normal"
                        *ngIf="sampleData.id_statuspengujian == 1"
                        matTooltip="Normal"
                    >
                        <p class="text-truncate">
                            Normal
                        </p>
                    </div>
                    <div
                        class="box-urgent"
                        *ngIf="sampleData.id_statuspengujian == 2"
                        matTooltip="Urgent"
                    >
                        <p class="text-truncate">
                            Urgent
                        </p>
                    </div>
                    <div
                        class="box-very-urgent"
                        *ngIf="sampleData.id_statuspengujian == 3"
                        matTooltip="Very Urgent"
                    >
                        <p class="text-truncate">
                            Very Urgent
                        </p>
                    </div>
                </mat-cell>
            </ng-container>

            <!-- Column -->
            <ng-container matColumnDef="stat_bobot">
                <mat-header-cell *matHeaderCellDef mat-sort-header="stat_bobot">Weight Value(Bobot)</mat-header-cell>
                <mat-cell *matCellDef="let sampleData" fxHide fxShow.gt-md>
                    <div class="box-normal" *ngIf="sampleData.bobotsample.length > 0" matTooltip="already">
                        <p class="text-truncate"  style="color: #fff;" >already</p>
                    </div>
                    <div class="box-very-urgent" *ngIf="sampleData.bobotsample.length == 0" matTooltip="not yet">
                        <p class="text-truncate"  style="color: #fff;">not yet</p>
                    </div>
                </mat-cell>
              </ng-container>

            <!-- Column -->
            <ng-container matColumnDef="sample_uji">
            <mat-header-cell *matHeaderCellDef mat-sort-header="sample_uji">Sample Test</mat-header-cell>
            <mat-cell *matCellDef="let sampleData" fxHide fxShow.gt-md>
                <div *ngIf="this.sampleData.sample_condition.groups == 'PREPARATION'  && this.sampleData.sample_condition_pre[sampleData.sample_condition_pre.length - 1].status == 0">
                    <mat-icon role="img" class="mat-icon notranslate secondary-fg material-icons mat-icon-no-color ng-star-inserted" aria-hidden="true" data-mat-icon-type="font"  style="color: #e7e6e1;" matTooltip="Not Yet">check_circle</mat-icon>
                </div>
                <div *ngIf="this.sampleData.sample_condition.groups == 'PREPARATION' && this.sampleData.sample_condition_pre[sampleData.sample_condition_pre.length - 1].status == 1" >
                    <mat-icon role="img" class="mat-icon notranslate green-text material-icons mat-icon-no-color ng-star-inserted" aria-hidden="true" data-mat-icon-type="font"  style="color:#61b15a;" matTooltip="Checked">check_circle</mat-icon>
                </div>
            </mat-cell>
            </ng-container>

             <!-- Column -->
            <ng-container matColumnDef="action" >
                <mat-header-cell *matHeaderCellDef mat-sort-header>Action</mat-header-cell>
                <mat-cell *matCellDef="let sampleData; let i = index;">
                    <div fxFlex="row" fxLayoutAlign="space-evenly center">
                        <button matTooltip="Sample"  mat-icon-button color="primary"  (click)="gotoModulBobot(sampleData)">
                            <mat-icon>add_circle_outline</mat-icon>
                        </button>
                        <button matTooltip="Prep Memo" [ngStyle]="{'color': sampleData.kontrakuji.description_preparation.length > 0 ? 'green' : 'grey' }" mat-icon-button color="primary"  (click)="descriptionInfoModals(sampleData.id, 'withID')">
                            <mat-icon>info</mat-icon>
                        </button>
                        <button mat-icon-button [matMenuTriggerFor]="menu" stle="color: #ef4f4f;" (click)="getbobotSample(sampleData.id)">
                            <mat-icon>more_vert</mat-icon>
                        </button>
                        <mat-menu #menu="matMenu">
                            <button [disabled]="this.databobotsample.length > 0 ? false : true"  mat-menu-item (click)="copybobotSambple(sampleData.id)" >
                                <mat-icon>file_copy</mat-icon>
                                <span>Copy</span>
                            </button>
                            <button [disabled]="this.copyBobotSample.length > 0 ? false : true" mat-menu-item (click)="pastebobotSambple(sampleData.id)"  >
                                <mat-icon>launch</mat-icon>
                                <span>Paste</span>
                            </button>
                        </mat-menu>
                    </div>
              </mat-cell>
            </ng-container>
            
            <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
            <mat-row *matRowDef="let sampledata; columns: displayedColumns;"
            [@animate]="{value:'*',params:{y:'100%'}}"
            [ngClass]="{'selected' : sampledata == selected}">
           </mat-row>           

        </mat-table>

        <div *ngIf="loadingfirst && this.sampleData.length === 0" style="width: 20%; margin-left: auto; margin-right: auto; margin-top: auto; margin-bottom: auto; display: block; text-align: center;">
            <img  src="assets/images/gif/loading.gif" />
            <small>Please Wait ...</small>
        </div>

        <div *ngIf="!loadingfirst && this.sampledata.length === 0" style="width: 20%; margin-left: auto; margin-right: auto; margin-top: auto; margin-bottom: auto; display: block; text-align: center;">
            <img  src="assets/images/gif/selectfile.gif" />
            <small>No Data</small>
        </div>
        </mat-card>

    </div>
</div>